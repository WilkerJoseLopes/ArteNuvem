{% extends "base.html" %}
{% block content %}
<h1>ExposiÃ§Ã£o do MÃªs</h1>

<div class="actions-row">
    <button onclick="gerarPDF('catalogo')">ðŸ“„ Gerar catÃ¡logo (PDF)</button>
    <button onclick="gerarPDF('certificado')">ðŸ“œ Gerar certificado (PDF)</button>
</div>

{% if top %}
<div class="grid">
    {% for img, votos in top %}
    <div class="card">
        <img src="{{ img.caminho_armazenamento }}" alt="{{ img.titulo }}">
        <div class="card-body">
            <h3>{{ img.titulo }}</h3>
            <p>Autor ID: {{ img.id_utilizador }}</p>
            <p>Votos: {{ votos }}</p>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p>A exposiÃ§Ã£o do mÃªs serÃ¡ anunciada brevemente.</p>
{% endif %}

<script>
    async function gerarPDF(tipo) {
        try {
            const res = await fetch(`/pdf/${tipo}`);
            const data = await res.json();
            if (data.pdf_url) {
                window.open(data.pdf_url, '_blank');
            } else if (data.error) {
                alert("Erro ao gerar PDF: " + data.error);
            } else {
                alert("NÃ£o foi possÃ­vel gerar o PDF.");
            }
        } catch (e) {
            alert("Erro de comunicaÃ§Ã£o com o servidor.");
        }
    }
</script>
{% endblock %}
