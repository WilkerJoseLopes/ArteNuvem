{% extends "base.html" %}

{% block title %}ArteNuvem{% endblock %}

{% block content %}

<div class="container">

    <!-- Pesquisa + Filtros -->
    <form method="get" action="/" class="search-bar">
        <input
            type="text"
            name="q"
            placeholder="Pesquisar por título ou tags..."
            value="{{ query_text or '' }}"
        >

        <select name="categoria">
            <option value="">Todas as categorias</option>
            {% for cat in categorias %}
                <option value="{{ cat.id }}"
                    {% if selected_categoria == cat.id %}selected{% endif %}
                >
                    {{ cat.nome }}
                </option>
            {% endfor %}
        </select>

        <button type="submit">Pesquisar</button>
    </form>

    {% if em_pesquisa %}
        <!-- Resultados da pesquisa -->
        <section class="section">
            <h2>
                Resultados{% if query_text %} para “{{ query_text }}”{% endif %}
            </h2>

            <div class="grid">
                {% for img in imagens %}
                    <div class="card">
                        <a href="{{ url_for('imagem_detalhe', imagem_id=img.id) }}">
                            <img
                                src="{{ img.caminho_armazenamento }}"
                                alt="{{ img.titulo }}"
                                loading="lazy"
                            >
                        </a>
                        <div class="card-body">
                            <h3>{{ img.titulo }}</h3>
                            {% if img.categoria_texto %}
                                <span class="badge">{{ img.categoria_texto }}</span>
                            {% endif %}
                        </div>
                    </div>
                {% else %}
                    <p>Nenhum resultado encontrado.</p>
                {% endfor %}
            </div>
        </section>

    {% else %}

        <!-- Recomendações -->
        <section class="section">
            <h2>Recomendações</h2>

            <div class="grid">
                {% for img in recomendacoes %}
                    <div class="card">
                        <a href="{{ url_for('imagem_detalhe', imagem_id=img.id) }}">
                            <img
                                src="{{ img.caminho_armazenamento }}"
                                alt="{{ img.titulo }}"
                                loading="lazy"
                            >
                        </a>
                        <div class="card-body">
                            <h3>{{ img.titulo }}</h3>
                            {% if img.categoria_texto %}
                                <span class="badge">{{ img.categoria_texto }}</span>
                            {% endif %}
                        </div>
                    </div>
                {% else %}
                    <p>Sem recomendações disponíveis.</p>
                {% endfor %}
            </div>
        </section>

        <!-- Catálogo -->
        <section class="section">
            <h2>Catálogo</h2>

            <div class="grid">
                {% for img in imagens %}
                    <div class="card">
                        <a href="{{ url_for('imagem_detalhe', imagem_id=img.id) }}">
                            <img
                                src="{{ img.caminho_armazenamento }}"
                                alt="{{ img.titulo }}"
                                loading="lazy"
                            >
                        </a>
                        <div class="card-body">
                            <h3>{{ img.titulo }}</h3>
                            {% if img.categoria_texto %}
                                <span class="badge">{{ img.categoria_texto }}</span>
                            {% endif %}
                        </div>
                    </div>
                {% else %}
                    <p>Nenhuma imagem encontrada.</p>
                {% endfor %}
            </div>
        </section>

    {% endif %}

</div>

{% endblock %}
